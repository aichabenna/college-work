#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>
#include "listJobs.h"

void initialise_list(listJobs * list){
    list = malloc(sizeof(struct listJobs));
    if(list == NULL){
        printf("erreur\n");
    }
    list->next = NULL;
    list->cell_job = malloc(sizeof(struct job));
    list->cell_job->id = 0;
    list->cell_job->pid = 0;
    list->cell_job->cmdline = "minishell";
    list->cell_job->etat = ACTIF_FG;
}

int length_list(listJobs *list){
    int length = 0;
    listJobs * copy = list;
    while(copy != NULL ){
        length++;
        copy = copy->next;
    }
    return length;
}

listJobs * add_job(listJobs * list, pid_t pid, char * cmdline, etat etat, int id){
    listJobs * new_list = malloc(sizeof(struct listJobs));
    new_list->cell_job = malloc(sizeof(struct job));
    new_list->cell_job->id = id;
    new_list->cell_job->pid = pid;
    new_list->cell_job->cmdline =cmdline;
    new_list->cell_job->etat = etat;
    new_list->next = list;
    return new_list;
}

void delete_job(listJobs * list, pid_t pid){
    listJobs *copy = list;

    while(copy != NULL){
        if(copy->cell_job->pid == pid){
            listJobs *to_be_deleted = copy;
            copy = to_be_deleted->next;
            free(to_be_deleted->cell_job);
            free(to_be_deleted);
            break;
        }else{
            copy = copy->next;
        }
    }

}

pid_t get_pid(listJobs * list, int id){
    listJobs *copy = list;

    while(copy != NULL){
        if(copy->cell_job->id == id){
            return copy->cell_job->pid;
        }
        copy = copy->next;
    }
    return -1;
}

void set_etat(listJobs * list, pid_t pid, etat etat){
    listJobs *copy = list;

    while(copy != NULL){
        if(copy->cell_job->pid == pid){
            copy->cell_job->etat = etat;
            break;
        }
        copy = copy->next;
        
    }
}

void print_list(listJobs * list){
    if(list != NULL){
        printf("ID\t PID\t ETAT\t\t CMD\n");
        listJobs *copy = list;
        char * etat;
        while(copy != NULL){
                //if(copy->cell_job == NULL){
                //    printf("cell job null\n");
                //}
            if (copy->cell_job->etat == SUSPENDU){
                etat = "Suspendu";
            } else if(copy->cell_job->etat == ACTIF_BG){
                etat = "Actif(BG)";
            } else {
                etat = "Actif(FG)";
            }
            printf("%d\t %d\t %s\t %s\n", copy->cell_job->id, copy->cell_job->pid, etat, copy->cell_job->cmdline);
        
            copy = copy->next;
        }
    }
}