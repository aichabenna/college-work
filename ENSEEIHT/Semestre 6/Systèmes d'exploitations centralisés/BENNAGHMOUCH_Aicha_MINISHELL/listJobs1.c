#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <string.h>
#include <stdbool.h>
#include "listJobs.h"

void initialise_list(listJobs * list){
    list = malloc(sizeof(listJobs*));
    if(list == NULL){
        printf("erreur\n");
    }
    printf("write N\n");
    list->N = 0;
}

void add_job(listJobs * listJobs, pid_t pid, char * cmdline, etat etat){
    printf("inc  N\n");
    listJobs->N++;
    printf("read id\n");
    int id = listJobs->N;
    //listJobs->list = realloc(listJobs, id *sizeof(job));
    printf("write id\n");
    listJobs->list[id-1]->id = id;
    printf("write id done\n");
    listJobs->list[id-1]->pid = pid;
    listJobs->list[id-1]->cmdline = cmdline;
    listJobs->list[id-1]->etat = etat;
}

int get_pos(listJobs * listJobs, pid_t pid){
    int N = listJobs->N;
    for(int i = 0; i<N; i++){
        if(listJobs->list[i]->pid == pid){
            return i;
        }
    }
    return -1;
}

void delete_job(listJobs * listJobs, pid_t pid){
    int N = listJobs->N;
    int pos = get_pos(listJobs, pid);
    for(int i = pos+1; i<N; i++){
        listJobs->list[i-1] = listJobs->list[i];
    }
    listJobs->N--;
}

pid_t get_pid(listJobs * listJobs, int id){
    int N = listJobs->N;
    for(int i = 0; i<N; i++){
        if(listJobs->list[i]->id == id){
            return listJobs->list[i]->pid;
        }
    }
    return -1;
}

void set_etat(listJobs * listJobs, pid_t pid, etat etat){
    int N = listJobs->N;
    for(int i = 0; i<N; i++){
        if(listJobs->list[i]->pid == pid){
            listJobs->list[i]->etat = etat;
        }
    }
}

void print_list(listJobs * listJobs){
    printf("ID\t PID\t ETAT\t CMD\n");
    char *etat;
    for (int i = 0; i<listJobs->N; i++){
        if (listJobs->list[i]->etat == SUSPENDU){
            etat = "Suspendu";
        } else if(listJobs->list[i]->etat == ACTIF_BG){
            etat = "Actif(BG)";
        } else {
            etat = "Actif(FG)";
        }
        printf("%d\t %d\t %s\t %s\n", listJobs->list[i]->id, listJobs->list[i]->pid, etat, listJobs->list[i]->cmdline);
    }
}