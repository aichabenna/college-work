with Ada.Text_IO;           use Ada.Text_IO;
with Ada.Integer_Text_IO;   use Ada.Integer_Text_IO;
with Ada.Strings.Unbounded; use Ada.Strings.Unbounded;
with LCA;
with TREE;

procedure TEST_TREE is

    -- Instanciation du type T_LCA tel que:
    -- La clé est une chaine de caractères et la donnée est un entier
    package Tree_String_Integer is
            new TREE (T_Id => Unbounded_String, T_Data => Integer);
    use Tree_String_Integer;

    procedure print_tree(Tree: in T_tree; espace : in integer) is
    begin
        Put("(");
        Put(data(tree));
        Put(")");
        New_line;
        for i in 1..espace loop
            if i=1 then
                Put("|");
            end if;
            Put("    ");
        end loop;

        if is_leaf(tree)  then
            Put("'" & To_String(id(tree)) & "'");
            New_line;
        end if;
        if not is_empty(left (tree)) then
            Put("\--0--");
            print_tree(left(tree), espace+1);
        end if;
        if not is_empty(right (tree)) then
            Put("\--1--");
            print_tree(right(tree), espace+1);
        end if;

    end print_tree;

    tree_1, tree_2, tree_3: T_Tree;
    tree_4, tree_5: T_Tree;
    code : unbounded_string :=  To_Unbounded_String("00");
begin
    Put_line ("--- test initialize ---");
    Initialize(tree_1);
    Initialize(tree_2);

    pragma Assert (Is_Empty (tree_1));
    pragma Assert (Is_Empty (tree_2));

    Put_line ("--- test create leaf & node ---");
    Create_Leaf(tree_1, To_Unbounded_String("a"),1);
    Create_Leaf(tree_2, To_Unbounded_String("b"),2);

    Create_Node(tree_3, tree_1, tree_2, id(tree_1) & id(tree_2), data(tree_1)+data(tree_2)); --supprime tree_2 et ajoute la feuille b dans tree_1
    pragma Assert (data (tree_3) = 3);
    pragma Assert (id (tree_3) = "ab");

    Create_Leaf(tree_4, To_Unbounded_String("d"),4);

    Create_Node(tree_5, tree_3, tree_4, id(tree_3) & id(tree_4), data(tree_3)+data(tree_4)); --supprime tree_2 et ajoute la feuille b dans tree_1
    pragma Assert (data (tree_5) = 7);
    pragma Assert (id (tree_5) = "abd");
    print_tree(tree_5, 0);

    Put_line ("--- test parcours_infixe ---");
    Parcours_Infixe(tree_5);
    -- pourquoi j'ai les espaces :(((
    New_line;
    Put_line("Doit être égale à 0011");

    Put_line ("--- test codage Huffman ---");
    -- Codage Huffman
    -- fonction 1 : affichage pour debug
    put_line(To_string(Huffman_Code(tree_5,To_Unbounded_String("a")))); --00
    put_line(To_string(Huffman_Code(tree_5,To_Unbounded_String("b"))));-- 00 faux
    put_line(To_string(Huffman_Code(tree_5,To_Unbounded_String("d"))));-- 00 faux

    -- function 2 : affichage pour debug
    --Huffman_Code_bis2(Tree : in T_Tree; Id: in T_id; code: in out String; index : in integer) ;
    put_line(To_string(Huffman_Code_bis2(tree_5,To_Unbounded_String("a"), code, 1) ));
    put_line ("start");
    put_line(To_string(code));
    put_line(To_string(Huffman_Code_bis2(tree_5,To_Unbounded_String("b"), code, 1)) );
    put_line(To_string(code));
    put_line("end");
    put_line(To_string(Huffman_Code_bis2(tree_5,To_Unbounded_String("d"), code, 1)) );

    -- function 1 : assert
    pragma Assert (To_string(Huffman_Code(tree_5,To_Unbounded_String("a")) ) = "00");
    pragma Assert (To_string(Huffman_Code(tree_5,To_Unbounded_String("b") ) )= "01"); -- faux
    pragma Assert (To_string(Huffman_Code(tree_5,To_Unbounded_String("d")) ) = "1");

    -- function 2 : assert
    -- later

    -- Affichage du codage Huffman
    -- function 3
    --Huffman_Code_bis(tree_5, To_Unbounded_String("a"), l, 1);
    --Huffman_Code_bis(tree_5, To_Unbounded_String("b"), l, 1);
    --Huffman_Code_bis(tree_5, To_Unbounded_String("d"), l, 1);



    free_tree(tree_1);
    free_tree(tree_2);
    free_tree(tree_3);
    free_tree(tree_4);
    free_tree(tree_5);

    Put_Line(" All tests passed successfuly !");


end Test_TREE;
